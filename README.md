# modr-bot
Slack bot to simplify creation and retrieval of Architectural Decision Records (ADRs) from a GitHub repo.

`modr` stands for Markdown Organizational Decision Record - a riff on Architectural Decision Record which hints that, just maybe, we should be making a record of all decisions, not just architecture ones.

## introduction
- why modr-bot was created
- who is it for
- what IRL practices will help you get the most out of modr-bot

## How to install it
To use modr-bot a few assumptions are made:
- you have `node` and `yarn` installed
- you have a Slack workspace and can install apps to it
- you have a GitHub repo that you use to store ADRs

Given the above, follow these steps to get set up.
### Create a Slack App
- Create a new app at [api.slack.com](https://api.slack.com/apps?new_app=1). Give the app a cool name and select the workspace you would like to install it to.
- Select `Socket Mode` from the left nav menu and toggle the switch for socket mode. This will prompt you to create a new app-level token. Copy the key generated by Slack and use it for the `SLACK_APP_TOKEN` environment variable.
- Select `Slash Command` from the left nav menu and create a new slash command. Name the command `decision` and give it a short, useful description (ie: "Manages ADRs")
- Select `Basic Information` from the left nav menu and click `Install to Workspace`
- From the `Basic Information` page find the `Signing Secret` key and save that to the environment variable `SLACK_SIGNING_SECRET`
- Select `OAuth & Permissions` from the left nav menu and find the `Bot User OAuth Token` value. Copy this to the `SLACK_BOT_TOKEN` environment variable.

At this point you should have a working Slack app.

### Generate a GitHub Personal Access Token
Go to Settings -> Developer settings in your ADR repo and create a new Personal Access Token. Copy this token and store it in the `GITHUB_TOKEN` environment variable.

### Get the code and set up the environment
Clone this repo.

The app reads its config from the environment. `package.json` includes `yarn run dev` script which will use `dotenv` package to look for a `.env` file in the root directory, which it uses to set up the environment. It also uses `nodemon` to allow for hot restarts and IDE debugging.

In a production environment, for now it's up to you to figure out how to get env variables ready for the app.

The remaining env variables required by `modr-bot` are:
- `GITHUB_USER`: the name of the owner of the GitHub repo containing ADRs
- `GITHUB_REPO`: the name of the repo containing ADRs
- `PORT`: port used to set up a socket connection with Slack
- `GITHUB_PATH_TO_ADRS`: the path to ADRs in your repo, e.g.: `/docs/decisions`
- `GITHUB_ADR_REGEX`: a javascript regex that matches valid ADR file names. For example: `[0-9]+(?:-\w+)+\.md` will match files of the type `0015-what-database-to-use.md`
- `GITHUB_DEFAULT_BRANCH`: branch to create new branches from, and to create pull requests to. For example, `master` or `main`

The following variables allow you to use your own ADR template
- `GITHUB_ADR_TEMPLATE`: a template file that `modr-bot` can use to create new ADRs. Defaults to `decision-template.md` - the format can be viewed in this repo at `/docs/decisions/decision-template.md`
- `ADR_PARSER`: module that knows how to parse your ADR file. Path is relative to the `/lib` directory. Default is `./adrParser.js`
- `ADR_TO_BLOCK_TRANSFORMER`: module that knows how to take a parsed ADR file and transform it to block format that Slack can understand. Relative to the root directory. Defaults to `./lib/blockTransformer.js`

## how to use it

When `modr-bot` is properly installed in your Slack workspace, and the app is running and properly connected to Slack, it enables the `/decision` slash command. This command accepts the following subcommands:

### /decision log - display information about active or committed decisions
```
/decision log [options]

List ADRs that match all of the given (optional) filters.

Options:
  -s, --status <status...>       Filter on ADR status. (choices: "open", "committed", "deferred", "obsolete")
  -i, --impact <impact...>       Filter on ADR Impact. (choices: "high", "medium", "low")
  -ca, --committed-after <date>  Filter ADRs committed since the given date (yyyy-mm-dd format).
  -db, --decide-before <date>    Filter open ADRs that must be decided on before the given date (yyyy-mm-dd format).
  -t, --tags <tag...>            Filter on ADR tags.
  -h, --help                     display help for command

```

`modr-bot` uses [YAML Frontmatter](https://jekyllrb.com/docs/front-matter/) to store metadata about the decision, and to filter results of the `log` subcommand.

### /decision add - create a new ADR and set up the collaboration environment
```
/decision add [options]

create a new ADR in the repo on a new branch and create a pull request for collaboration.

Options:
  -i, --impact <impact>  Set impact=<impact> in new ADR. (choices: "high", "medium", "low", default: "medium")
  -t, --title <title>    Set the title of the new ADR. This will also be used as the name of the associated pull request.
  -b, --branch <branch>  Set the name of the new branch.
  -h, --help             display help for command
  ```

## Examples
The ADR files and associated YAML frontmatter created with `modr-bot` can be seen in the [/docs/decisions](./docs/decisions) directory in this repo.

## what's next
- production readiness (ie: docker)