# modr-bot
Slack bot to simplify creation and retrieval of Architectural Decision Records (ADRs) from a GitHub repo.

`modr` stands for Markdown Organizational Decision Record - a riff on Architectural Decision Record which hints that, just maybe, we should be making a record of all decisions, not just architecture ones.

## introduction
The ultimate aim of the project which created `modr-bot` is to help improve outcomes through quality decision making. One of the simplest and highest leverage steps you can take to improve the quality of your decisions is to *write them down*.

### Why write down decisions
Improving quality of decisions requires relfecting on past decisions to look for opportunities to do better in the future. If you fail to record your decision at the time it was made, along with the relevant *context*, you risk forgetting an important factor that influenced your decision. It's also likely you will fall prey to *hindsight bias* - basically, explaining away poor outcomes as bad luck, and taking credit for good outcomes where no credit is actually deserved. All of this degrades your ability to *learn* from past decisions and will prevent the improvement of decision quality over time.

The act of writing down your decision forces the author(s) to deeply understand the decision so they can put into words the problem, chosen path and context. The process of writing your decision down often uncovers hidden ambiguities or further questions that should be resolved before committing to the decision. As a result, the quality of the decision improves.

Finally, writing down a decision creates a single record that can be used as a collaboration point for a team, where all questions, comments and changes to the decision can be recorded. This improves decision quality by ensuring no information is lost (across multiple documents for example, or in unrecorded meeting conversations) and greatly improves context for future readers.

### Getting the most out of modr-bot
Out of the box, you can use `modr-bot` to pull information about ADRs from your GitHub repo or to create new ADRs using Slack. To get the most out of `modr-bot`, here are some tips:

- make a new ADR at the beginning of the decision making process, not at the end. The template can remind you of the important things you need to consider when making the decision (for example, the default template asks about the problem, the alternatives considered, the trade offs etc). Also, having an ADR skeleton at the beginning of the process creates a space for the team to collaborate
- use the YAML Frontmatter to record metadata about your decision.
    * think about the *impact and reversibility*. These will guide you on how much time to spend on the decision. A decision that is either highly reversible or low impact can be made quickly. A high impact and irreversible decision should be considered carefully.
    * merge the skeleton decision as soon as it's created. With a status attribute of `open` and a `decide-by` attribute set, it signals to the team that you are not committed to the decision yet. This also allows `modr-bot` to answer questions like "What big decisions are the team facing in the next two weeks".


## How to install it
To use modr-bot a few assumptions are made:
- you have `node` and `yarn` installed
- you have a Slack workspace and can install apps to it
- you have a GitHub repo that you use to store ADRs
- for each decision your team makes, you start by creating a branch, a new blank ADR, and a pull request. You use this pull request to collaborate and you update the ADR through commits to the branch. When the decision is committed, you merge the PR.

Given the above, follow these steps to get set up.
### Create a Slack App
- Create a new app at [api.slack.com](https://api.slack.com/apps?new_app=1). Give the app a cool name and select the workspace you would like to install it to.
- Select `Socket Mode` from the left nav menu and toggle the switch for socket mode. This will prompt you to create a new app-level token. Copy the key generated by Slack and use it for the `SLACK_APP_TOKEN` environment variable.
- Select `Slash Command` from the left nav menu and create a new slash command. Name the command `decision` and give it a short, useful description (ie: "Manages ADRs")
- Select `Basic Information` from the left nav menu and click `Install to Workspace`
- From the `Basic Information` page find the `Signing Secret` key and save that to the environment variable `SLACK_SIGNING_SECRET`
- Select `OAuth & Permissions` from the left nav menu and find the `Bot User OAuth Token` value. Copy this to the `SLACK_BOT_TOKEN` environment variable.

At this point you should have a working Slack app.

### Generate a GitHub Personal Access Token
Go to Settings -> Developer settings in your ADR repo and create a new Personal Access Token. Copy this token and store it in the `GITHUB_TOKEN` environment variable.

### Get the code and set up the environment
Clone this repo.

The app reads its config from the environment. `package.json` includes `yarn run dev` script which will use `dotenv` package to look for a `.env` file in the root directory, which it uses to set up the environment. It also uses `nodemon` to allow for hot restarts and IDE debugging.

In a production environment, for now it's up to you to figure out how to get env variables ready for the app.

The remaining env variables required by `modr-bot` are:
- `GITHUB_USER`: the name of the owner of the GitHub repo containing ADRs
- `GITHUB_REPO`: the name of the repo containing ADRs
- `PORT`: port used to set up a socket connection with Slack
- `GITHUB_PATH_TO_ADRS`: the path to ADRs in your repo, e.g.: `/docs/decisions`
- `GITHUB_ADR_REGEX`: a javascript regex that matches valid ADR file names. For example: `[0-9]+(?:-\w+)+\.md` will match files of the type `0015-what-database-to-use.md`
- `GITHUB_DEFAULT_BRANCH`: branch to create new branches from, and to create pull requests to. For example, `master` or `main`

The following variables allow you to use your own ADR template
- `GITHUB_ADR_TEMPLATE`: a template file that `modr-bot` can use to create new ADRs. Defaults to `decision-template.md` - the format can be viewed in this repo at `/docs/decisions/decision-template.md`
- `ADR_PARSER`: module that knows how to parse your ADR file. Path is relative to the `/lib` directory. Default is `./adrParser.js`
- `ADR_TO_BLOCK_TRANSFORMER`: module that knows how to take a parsed ADR file and transform it to block format that Slack can understand. Relative to the root directory. Defaults to `./lib/blockTransformer.js`

## how to use it

When `modr-bot` is properly installed in your Slack workspace, and the app is running and properly connected to Slack, it enables the `/decision` slash command. This command accepts the following subcommands:

### /decision log - display information about active or committed decisions
```
/decision log [options]

List ADRs that match all of the given (optional) filters.

Options:
  -s, --status <status...>       Filter on ADR status. (choices: "open", "committed", "deferred", "obsolete")
  -i, --impact <impact...>       Filter on ADR Impact. (choices: "high", "medium", "low")
  -ca, --committed-after <date>  Filter ADRs committed since the given date (yyyy-mm-dd format).
  -db, --decide-before <date>    Filter open ADRs that must be decided on before the given date (yyyy-mm-dd format).
  -t, --tags <tag...>            Filter on ADR tags.
  -h, --help                     display help for command

```

`modr-bot` uses [YAML Frontmatter](https://jekyllrb.com/docs/front-matter/) to store metadata about the decision, and to filter results of the `log` subcommand.

### /decision add - create a new ADR and set up the collaboration environment
```
/decision add [options]

create a new ADR in the repo on a new branch and create a pull request for collaboration.

Options:
  -i, --impact <impact>  Set impact=<impact> in new ADR. (choices: "high", "medium", "low", default: "medium")
  -t, --title <title>    Set the title of the new ADR. This will also be used as the name of the associated pull request.
  -b, --branch <branch>  Set the name of the new branch.
  -h, --help             display help for command
  ```

## Examples
The ADR files and associated YAML frontmatter created with `modr-bot` can be seen in the [/docs/decisions](./docs/decisions) directory in this repo.

## what's next
- production readiness (ie: docker)
- performance
